name: Deploy to EC2

on:
push:
branches: [ "main" ]

jobs:
deploy:
runs-on: ubuntu-latest

```
steps:
  - name: Checkout repo
    uses: actions/checkout@v4

  - name: Deploy to Server
    uses: appleboy/ssh-action@v1.0.3
    with:
      host: ${{ secrets.EC2_HOST }}
      username: ${{ secrets.EC2_USER }}
      key: ${{ secrets.EC2_SSH_KEY }}
      script: |
        cd ~/ai

        echo "ğŸ“¥ Pulling latest code"
        git pull origin main

        echo "ğŸ›‘ Stopping old containers"
        docker compose down

        echo "ğŸ§¹ Cleaning old images"
        docker image prune -af

        echo "ğŸ— Building new containers"
        docker compose up -d --build

        echo "âœ… Deploy finished"
```
